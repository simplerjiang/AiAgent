# Task Report

## Task
- ID: MANUAL
- Title: Verify Edge MCP evidence and port handling
- Timestamp: 20260214-134954

## English (For Agents)
### Summary
- Restarted backend on a free port and validated the stock info UI via Edge MCP.
- Captured trace/video artifacts and confirmed the 资讯影响 section renders.

### Changes
- Updated .github/copilot-instructions.md with a rule for port conflicts.
- Updated .automation/prompts/tester.md to require MCP evidence, port logging, and backend log checks.

### Tests (Run in Order)
1) Unit tests:
   - Command: dotnet test backend/SimplerJiangAiAgent.Api.Tests/SimplerJiangAiAgent.Api.Tests.csproj
   - Result: Pass (23 tests)
2) Unit tests (frontend):
   - Command: cd frontend && npm run test:unit
   - Result: Pass (23 tests, ECharts width/height warnings)
3) Edge MCP (UI check):
   - Browser: msedge
   - Ports: backend 5128, MCP 8931
   - Steps:
     - Build frontend and serve via backend on http://127.0.0.1:5128/
     - Start MCP server with user-data-dir .automation/edge-profile/run-20260214-134633
     - Open http://127.0.0.1:5128/, query sh600000, verify 资讯影响 renders
   - Evidence: .automation/reports/edge-mcp-20260214-134633/
   - Result: Pass (资讯影响 visible)

### Issues / Follow-ups
- Backend logs show EF Core decimal precision warnings; no runtime errors observed.

## 中文（给你看的）
### 摘要
- 后端改用空闲端口启动，并用 Edge MCP 验证股票信息 UI。
- 记录了 trace/video 证据并确认 资讯影响 面板可见。

### 修改内容
- 更新 .github/copilot-instructions.md：新增端口冲突处理规则。
- 更新 .automation/prompts/tester.md：要求记录 MCP 证据、端口与后端日志检查。

### 测试（按顺序）
1) 单元测试：
   - 命令：dotnet test backend/SimplerJiangAiAgent.Api.Tests/SimplerJiangAiAgent.Api.Tests.csproj
   - 结果：通过（23 条）
2) 前端单元测试：
   - 命令：cd frontend && npm run test:unit
   - 结果：通过（23 条，ECharts 宽高告警）
3) Edge MCP（UI 检查）：
   - 浏览器：msedge
   - 端口：后端 5128，MCP 8931
   - 步骤：
     - 构建前端并由后端托管 http://127.0.0.1:5128/
     - MCP 使用 .automation/edge-profile/run-20260214-134633
     - 打开 http://127.0.0.1:5128/，查询 sh600000，确认 资讯影响 显示
   - 证据：.automation/reports/edge-mcp-20260214-134633/
   - 结果：通过（资讯影响 可见）

### 问题 / 后续
- 后端日志有 EF Core decimal 精度警告，但未见运行时错误。
